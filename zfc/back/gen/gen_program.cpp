#include <back/gen/gen_main.hpp>
#include <common/debug.hpp>

void ProgramNode::write(std::ofstream& file) {

    gen::write(file, 
    "/* Intermediate C code - auto-generated by the ZFC compiler for the Z-flat programming language.\n"
    " * Do not modify - this may break programs. If there is an error, please contact Adam Hutchings.\n"
    " * If this file does not have an ending comment, the file may be incomplete and should not be used.\n"
    " */\n\n"
    );

    for (auto decl : this->imports) {
        decl->write(file);
    }

    // Write debug level
    gen::write(file, "#define ZF_DEBUG_LEVEL ");
    gen::write(file, std::to_string(debug::level));
    gen::write(file, "\n");

    for (auto sub : this->components) {
        sub->write(file);
        gen::write(file, "\n");
    }

    gen::write(file,
    "/* This file was written to completion - this is the end-of-file marker automatically generated. */\n"
    );

}
